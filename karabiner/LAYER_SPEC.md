# Karabiner レイヤー仕様書
*Vialベースの設計思想を取り入れた長押し修飾キー + レイヤーシステム*

## 設計コンセプト
### 長押し修飾キー（タップホールド機能）
- **効率性**: 手の移動を最小限に抑えた修飾キー配置
- **エルゴノミクス**: 左右の手でバランスよく修飾キーを分散
- **学習性**: 直感的で覚えやすいキー配置

### レイヤーシステム
- **Layer-0**: ベース + 長押し修飾キー
- **Layer-1**: 数字・記号（テンキー風配列）
- **Layer-2**: マウス・ナビゲーション（Vim風 + マウス制御）
- **Layer-3**: カーソル制御（WASD配置）

## レイヤートリガー
- **Space**: Layer-1をアクティベート（単体押しでスペース）
- **英数 (japanese_eisuu)**: Layer-2をアクティベート（単体押しで英数）
- **無変換 (japanese_kana)**: Layer-3をアクティベート（単体押しで無変換）

## Layer-0 (Default)

| キー | 機能 | 説明 |
|------|------|------|
| **上段** |||
| Q | 長押し→Left Alt、短押し→Q | 長押し修飾キー |
| W | △ | 未割り当て |
| E | △ | 未割り当て |
| R | 長押し→Left Alt、短押し→R | 長押し修飾キー |
| T | △ | 未割り当て |
| Y | △ | 未割り当て |
| U | △ | 未割り当て |
| I | △ | 未割り当て |
| O | △ | 未割り当て |
| P | △ | 未割り当て |
| **中段（ホーム行）** |||
| A | 長押し→Right Control、短押し→A | 長押し修飾キー |
| S | 長押し→Left Command、短押し→S | 長押し修飾キー |
| D | △ | 未割り当て |
| F | 長押し→Right Control、短押し→F | 長押し修飾キー |
| G | 長押し→Left Command、短押し→G | 長押し修飾キー |
| H | △ | 未割り当て |
| J | △ | 未割り当て |
| K | △ | 未割り当て |
| L | △ | 未割り当て |
| ; | △ | 未割り当て |
| **下段** |||
| Z | 長押し→Left Shift、短押し→Z | 長押し修飾キー |
| X | △ | 未割り当て |
| C | △ | 未割り当て |
| V | 長押し→Left Shift、短押し→V | 長押し修飾キー |
| B | △ | 未割り当て |
| N | △ | 未割り当て |
| M | △ | 未割り当て |
| , | △ | 未割り当て |
| . | △ | 未割り当て |
| / | △ | 未割り当て |

### Apple内蔵キーボード専用
- **Left Control** → Right Command
- **Left Command** → Left Option
- **Left Option** → Left Control

### 全キーボード共通

## Layer-1 (Numbers & Symbols)
**トリガー**: Space長押し

| キー | 機能 | 説明 |
|------|------|------|
| **上段** |||
| Q | 長押し→Left Alt、短押し→` | バッククォート |
| W | 7 | 数字7 |
| E | 8 | 数字8 |
| R | 長押し→Left Alt、短押し→9 | 数字9 |
| T | ' | シングルクォート |
| Y | F1 | ファンクションキー |
| U | F2 | ファンクションキー |
| I | F3 | ファンクションキー |
| O | F4 | ファンクションキー |
| P | F5 | ファンクションキー |
| **中段（ホーム行）** |||
| A | 長押し→Right Control、短押し→- | ハイフン・マイナス |
| S | 長押し→Left Command、短押し→4 | 数字4 |
| D | 5 | 数字5 |
| F | 長押し→Right Control、短押し→6 | 数字6 |
| G | 長押し→Left Command、短押し→. | ピリオド |
| H | F6 | ファンクションキー |
| J | F7 | ファンクションキー |
| K | F8 | ファンクションキー |
| L | F9 | ファンクションキー |
| ; | F10 | ファンクションキー |
| **下段** |||
| Z | 長押し→Left Shift、短押し→= | イコール |
| X | 1 | 数字1 |
| C | 2 | 数字2 |
| V | 長押し→Left Shift、短押し→3 | 数字3 |
| B | 0 | 数字0 |
| N | F11 | ファンクションキー |
| M | F12 | ファンクションキー |
| , | [ | 開き角括弧 |
| . | ] | 閉じ角括弧 |
| / | \ | バックスラッシュ |

## Layer-2 (Mouse & Navigation)
**トリガー**: 英数長押し

| キー | 機能 | 説明 |
|------|------|------|
| **上段** |||
| Q | 長押し→Left Alt、短押し→Escape | Escapeキー |
| W | 水平スクロール左 | マウス横スクロール |
| E | 垂直スクロール上 | マウス縦スクロール |
| R | 水平スクロール右 | マウス横スクロール |
| T | マウス進む(Button5) | ブラウザ進む |
| Y | Home | 行頭移動 |
| U | Page Down | ページダウン |
| I | Page Up | ページアップ |
| O | End | 行末移動 |
| P | Print Screen | スクリーンショット |
| **中段（ホーム行）** |||
| A | 長押し→Right Control、短押し→- | ハイフン |
| S | 長押し→Left Command、短押し→Enter | 改行・決定 |
| D | 垂直スクロール下 | マウス縦スクロール |
| F | 左クリック(Button1) | マウス左クリック |
| G | 中クリック(Button3) | マウス中クリック |
| H | ← | 左矢印（Vim風） |
| J | ↓ | 下矢印（Vim風） |
| K | ↑ | 上矢印（Vim風） |
| L | → | 右矢印（Vim風） |
| ; | △ | 下位レイヤー透過 |
| **下段** |||
| Z | 長押し→Left Shift、短押し→\ | バックスラッシュ |
| X | Backspace | 後退削除 |
| C | Delete | 前進削除 |
| V | 右クリック(Button2) | マウス右クリック |
| B | マウス戻る(Button4) | ブラウザ戻る |
| N | F17 | ファンクションキー |
| M | F16 | ファンクションキー |
| , | F18 | ファンクションキー |
| . | F19 | ファンクションキー |
| / | Caps Lock | 大文字ロック |

## Layer-3 (Cursor Control)
**トリガー**: 無変換 (japanese_kana) 長押し

| キー | 機能 | 説明 |
|------|------|------|
| **上段** |||
| Q | △ | 未割り当て |
| W | ↑ | 上矢印 |
| E | △ | 未割り当て |
| R | △ | 未割り当て |
| T | △ | 未割り当て |
| Y | △ | 未割り当て |
| U | △ | 未割り当て |
| I | △ | 未割り当て |
| O | △ | 未割り当て |
| P | △ | 未割り当て |
| **中段（ホーム行）** |||
| A | ← | 左矢印 |
| S | ↓ | 下矢印 |
| D | → | 右矢印 |
| F | △ | 未割り当て |
| G | △ | 未割り当て |
| H | △ | 未割り当て |
| J | △ | 未割り当て |
| K | △ | 未割り当て |
| L | △ | 未割り当て |
| ; | △ | 下位レイヤー透過 |
| **下段** |||
| Z | △ | 未割り当て |
| X | △ | 未割り当て |
| C | △ | 未割り当て |
| V | △ | 未割り当て |
| B | △ | 未割り当て |
| N | △ | 未割り当て |
| M | △ | 未割り当て |
| , | △ | 未割り当て |
| . | △ | 未割り当て |
| / | △ | 未割り当て |

## 特殊設定

### Parallels対応（RDP & Input Switching）
Parallelsアプリ使用時のみ：
- Left Command ↔ Left Control入れ替え
- Right Command ↔ Right Control入れ替え
- Right Control + Q → Alt + F4

### G600マウス設定（レイヤー毎）
G600マウス（vendor_id: 1133, product_id: 49738）のテンキーボタンをVialでレイヤー毎にリマップ：

#### Layer-0（ベースレイヤー）
| キー | 機能 | 説明 |
|------|------|------|
| Keypad 7 | △ | 未割り当て |
| Keypad 8 | △ | 未割り当て |
| Keypad 9 | △ | 未割り当て |
| Keypad - | △ | 未割り当て |
| Keypad 4 | △ | 未割り当て |
| Keypad 5 | △ | 未割り当て |
| Keypad 6 | △ | 未割り当て |
| Keypad + | △ | 未割り当て |
| Keypad 1 | △ | 未割り当て |
| Keypad 2 | △ | 未割り当て |
| Keypad 3 | △ | 未割り当て |
| Keypad = | Keypad = | テンキーイコール |
| Keypad 0 | △ | 未割り当て |
| Keypad . | △ | 未割り当て |
| Keypad Enter | Keypad Enter | テンキーエンター |
| 左クリック | △ | 未割り当て |
| 右クリック | △ | 未割り当て |
| 中クリック | △ | 未割り当て |
| 戻るボタン | △ | 未割り当て |
| 進むボタン | △ | 未割り当て |
| 上スクロール | △ | 未割り当て |
| 下スクロール | △ | 未割り当て |
| 左スクロール | △ | 未割り当て |
| 右スクロール | △ | 未割り当て |

#### Layer-1（数字・記号レイヤー）
| キー | 機能 | 説明 |
|------|------|------|
| Keypad 7 | △ | 透過 |
| Keypad 8 | △ | 透過 |
| Keypad 9 | △ | 透過 |
| Keypad - | △ | 透過 |
| Keypad 4 | △ | 透過 |
| Keypad 5 | △ | 透過 |
| Keypad 6 | △ | 透過 |
| Keypad + | △ | 透過 |
| Keypad 1 | △ | 透過 |
| Keypad 2 | △ | 透過 |
| Keypad 3 | △ | 透過 |
| Keypad = | △ | 透過 |
| Keypad 0 | △ | 透過 |
| Keypad . | △ | 透過 |
| Keypad Enter | △ | 透過 |
| 左クリック | △ | 透過 |
| 右クリック | △ | 透過 |
| 中クリック | △ | 透過 |
| 戻るボタン | △ | 透過 |
| 進むボタン | △ | 透過 |
| 上スクロール | △ | 透過 |
| 下スクロール | △ | 透過 |
| 左スクロール | △ | 透過 |
| 右スクロール | △ | 透過 |

#### Layer-2（マウス・ナビゲーションレイヤー）
| キー | 機能 | 説明 |
|------|------|------|
| Keypad 7 | △ | 透過 |
| Keypad 8 | △ | 透過 |
| Keypad 9 | △ | 透過 |
| Keypad - | △ | 透過 |
| Keypad 4 | △ | 透過 |
| Keypad 5 | △ | 透過 |
| Keypad 6 | △ | 透過 |
| Keypad + | △ | 透過 |
| Keypad 1 | △ | 透過 |
| Keypad 2 | △ | 透過 |
| Keypad 3 | △ | 透過 |
| Keypad = | △ | 透過 |
| Keypad 0 | △ | 透過 |
| Keypad . | △ | 透過 |
| Keypad Enter | △ | 透過 |
| 左クリック | △ | 透過 |
| 右クリック | △ | 透過 |
| 中クリック | △ | 透過 |
| 戻るボタン | △ | 透過 |
| 進むボタン | △ | 透過 |
| 上スクロール | △ | 透過 |
| 下スクロール | △ | 透過 |
| 左スクロール | △ | 透過 |
| 右スクロール | △ | 透過 |

#### Layer-3（カーソル制御レイヤー）
| キー | 機能 | 説明 |
|------|------|------|
| Keypad 7 | △ | 透過 |
| Keypad 8 | △ | 透過 |
| Keypad 9 | △ | 透過 |
| Keypad - | △ | 透過 |
| Keypad 4 | △ | 透過 |
| Keypad 5 | △ | 透過 |
| Keypad 6 | △ | 透過 |
| Keypad + | △ | 透過 |
| Keypad 1 | △ | 透過 |
| Keypad 2 | △ | 透過 |
| Keypad 3 | △ | 透過 |
| Keypad = | △ | 透過 |
| Keypad 0 | △ | 透過 |
| Keypad . | △ | 透過 |
| Keypad Enter | △ | 透過 |
| 左クリック | △ | 未割り当て |
| 右クリック | △ | 未割り当て |
| 中クリック | △ | 未割り当て |
| 戻るボタン | △ | 未割り当て |
| 進むボタン | △ | 未割り当て |
| 上スクロール | △ | 未割り当て |
| 下スクロール | △ | 未割り当て |
| 左スクロール | △ | 未割り当て |
| 右スクロール | △ | 未割り当て |

## 使用上の注意

### 長押し修飾キーのコツ
1. **短いタップ**: 通常のキー入力（Q, R, A, S, F, G, V, Z）
2. **長押し**: 修飾キーとして機能（200ms以上の長押し）
3. **修飾キー透過**: レイヤー内でも既存の修飾キーが動作

### 学習の段階
1. **第1段階**: Layer-0の長押し修飾キーに慣れる
2. **第2段階**: Layer-1のテンキー配列をマスター
3. **第3段階**: Layer-2のマウス・ナビゲーション機能を活用
4. **第4段階**: Layer-3のカーソル制御機能を活用

## 今後の拡張予定

### Layer-3の拡張
- **カーソル制御拡張**: Page Up/Down、Home/End
- **ウィンドウ管理**: デスクトップ切り替え、ウィンドウ移動
- **システム機能**: スクリーンショット、通知センター

### 機能改良
- **マクロ機能**: よく使う文字列の自動入力
- **コンボキー**: 複数キー同時押しでの特殊機能
- **タップダンス**: 同じキーの連続タップで異なる機能

この仕様書を基に、段階的にKarabiner設定を実装・改良していきます。